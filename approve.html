<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="static/css/onlinebooking.css?2014-03-07-1" media="all" />
		<link rel="stylesheet" type="text/css" href="static/css/template/weimob-ui-1-1.css?2014-03-07-1" media="all" />
		<link rel="stylesheet" type="text/css" href="static/css/template/common.css?2014-03-07-1" media="all" />
		<script type="text/javascript" src="static/src/jQuery.js"></script>
		<script type="text/javascript" src="static/src/jquery.ba-resize.min.js"></script>
		<script type="text/javascript" src="static/src/echarts.min.js"></script>
		<title>报表统计</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">       
        <!-- Mobile Devices Support @begin -->
            <meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
            <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
            <meta content="no-cache" http-equiv="pragma">
            <meta content="0" http-equiv="expires">
            <meta content="telephone=no, address=no" name="format-detection">
            <meta name="apple-mobile-web-app-capable" content="yes" /> <!-- apple devices fullscreen -->
            <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <!-- Mobile Devices Support @end -->
        <style>
            img{max-width:100%!important;}
			.showdia {
				color: #ee4040;
				cursor: pointer;
			}
        #popLayer {
            display: none;
            background-color: #B3B3B3;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: 10;
            -moz-opacity: 0.8;
            opacity:.80;
            filter: alpha(opacity=80);/* 只支持IE6、7、8、9 */
        }
        #popBox,#popContent {
            display: none;
            background-color: #FFFFFF;
            z-index: 11;
            width: 320px;
            height: 200px;
            position:fixed;
            top:0;
            right:0;
            left:0;
            bottom:0;
            margin:auto;
        }	
        #popBox .close,#popContent .close{
            background-color: #F8F8F8;
			height: 30px;
			line-height: 30px;
        }
		#popBox .close div{
			width: 50%;
			float: left;		
		}
        #popBox .close a,.#popContent .close a {
            text-decoration: none;
            color: #2D2C3B;
        }
		#popContent .content label{
			display: inline-block;
		}
		#popContent .close div{
			width: 50%;
			float: left;		
		}
		.approveTitle{
			height: 50px;
			line-height: 50px;
			background: #fff;
			padding: 0 10px;
			text-align: center;
		}
		.approveTitle img{
			position: absolute;
			left: 10px;
			top: 9px;
			border: none;
		}
		.approve_list li{
			width: 50%;
			float: left;
		}
		.approveBottom{
			position: fixed;
			bottom: 0;
			height: 50px;
			width: 100%;
			background: #fff;
		}
		.approve_list li{
			text-align: center;
			padding: 5px 0;
		}
		.approve_list img{
			height: 16px;
		}
		.approveActive{
			color: #409eff;
		}
		.nodata {
			border: none;
			color: #666;
			font-size: 14px;
			text-align: center;
			height: 60px;
			line-height: 60px;
		}
		.approveList span{
			display: inline-block;
		}
		.approveList .content{
			width: 70%;
			text-align: left;
		}
		.approveList .time{
			width: 30%;
			text-align: right;
		}
		.home_section{
			padding:10px;
		}
		.contentList{
			height: 50px;
			line-height: 50px;
		}
		.ybTitle{
			text-align: left;			
		}
		.ybTitle span{
			border-left: 3px solid #409eff;
			padding-left: 5px;
		}
		.closeBtn{
			text-align: right;
		}
		.close{
			padding: 0 5px;
		}
        </style>
    </head>
    <body>
		<div class="masklayer" ontouchmove="return true;" onclick="$(this).toggleClass('on');">
			<script>
				var isAndroid = navigator.userAgent.toLowerCase().indexOf("android");
				document.write(isAndroid>-1?"<img src='static/img/instruction_android.png' alt='' style='width: auto!important;'>":"<img src='static/img/instruction_iphone.png' alt='' style='width: auto!important;'>");
			</script>
		</div>
		<div class="cardexplain">
			
		<!--后台可控制是否显示-->
			<section class="home_section">				
					<div>
						<div class="tableData">
							<div class="home_datalist">
								<div class="approveList" style=""width: 100%"></div>
							</div>		
						</div>
						<div class="tableData overWork" style="display: none;">
							<div class="approveList" style=""width: 100%"></div>
						</div>
								
				</div>				
			</section>
		</div>
	<div id="popLayer"></div>
	<div id="popBox">
		<div class="close">
			<div class="ybTitle"><span>未办</span></div>
			<div class="closeBtn"><a href="javascript:void(0)" onclick="closeBox()">X</a></div>
		</div>
		<div class="content">
			<div style="display: flex;align-items: center;padding: 10px;">
				<span class="appId" style="display: none;"></span>
				<span class="jhnf" style="display: none;"></span>
				<span class="jhbk" style="display: none;"></span>
				<span class="jhxh" style="display: none;"></span>
				<label>
					审批意见:
				</label>
				<textarea class="czyj" style="height: 60px;width: 200px;padding-left: 5px;"></textarea>
			</div>
			<div style="text-align:center;margin-top: 20px;">
				<span style="display: inline-block; padding: 4px 16px;background: #409eff;color: #fff;margin: 0 6px;border-radius: 4px" onclick="submit()">通过</span>
				<span style="display: inline-block; padding: 4px 16px;background: #409eff;color: #fff;margin: 0 6px;border-radius: 4px" onclick="backApprove()">退回</span>
			</div>
		</div>
	</div>
	<div id="popContent">
		<div class="close">
			<div class="ybTitle"><span>已办</span></div>
			<div class="closeBtn"><a href="javascript:void(0)" onclick="closeBox()">X</a></div>
		</div>
		<div class="content">
			<div>
				<span class="appId" style="display: none;"></span>
				<span class="jhnf" style="display: none;"></span>
				<span class="jhbk" style="display: none;"></span>
				<span class="jhxh" style="display: none;"></span>
			</div>
			<div style="display: flex;align-items: center;padding: 10px;">			
				<label>
					审核时间:
				</label>
				<span class="approveTime"></span>					
			</div>
			<div style="display: flex;align-items: center;padding: 10px;">		
				<label>
					审批结果:
				</label>
				<span class="approveResult"></span>
			</div>
			<div style="display: flex;align-items: center;padding: 10px;">		
				<label>
					审批意见:
				</label>
				<textarea class="approveS" style="height: 60px;width: 200px;padding-left: 5px;"></textarea>
			</div>
		</div>
	</div>
	<div class="approveBottom">
		<ul class="approve_list">
			<li class="approveActive">
				<img class="dbImg" src="static/img/db_on.png" />
				<div>未办</div>
			</li>
			<li>
				<img class="ybImg" src="static/img/yb.png" />
				<div>已办</div>
			</li>
		</ul>
	</div>

<script type="text/javascript">
	var type = "未办"	
	$(function(){						
		getUser();			
	})
	$(".approve_list>li").click(function () {
		$(this).addClass("approveActive").siblings().removeClass("approveActive");
		var index = $(this).index();
		if(index == 1){
			$(".tableData").hide();
			$(".overWork").show();
			type = "已办"
			$(".dbImg").attr('src',"static/img/db.png")
			$(".ybImg").attr('src',"static/img/yb_on.png")
		}else{
			$(".tableData").show();
			$(".overWork").hide();
			type = "未办"
			$(".dbImg").attr('src',"static/img/db_on.png")
			$(".ybImg").attr('src',"static/img/yb.png")
		}
		approveList(type);
	});	
	function getUser(){
		//var id = sessionStorage.getItem('usInfo')
		$.ajax({
             type: "POST",
             url: "http://10.18.3.98:8586/xntzjh/user/userInfo.d",
             data: {adzh:"sunyuan.xnyq"},
             dataType: "json",
             success: function(res){
                var thHtml = "";
				thHtml = ""
				var dataList = 	res;
				var trHtml = ""
				var html = "";
				if(dataList.success == true){
					var usInfo = res.data;
					sessionStorage.setItem("usInfo",JSON.stringify(usInfo));
					approveList(type);
				}else{				
					$(".approveList").append("<div class='nodata'>暂无数据</div>")
					$(".approveList").css("border","none");
				}					
            }
        });
		return false;
	}
	function approveList(type){
		var barData = [];
		var userArry = JSON.parse(sessionStorage.getItem('usInfo'))
		var userId = $.trim(userArry[0].usrId);
		$(".approveList").html('');
		$.ajax({
             type: "POST",
             url: "http://10.18.3.98:8586/xntzjh/fgsjhfj/fgsJhShLb.d",
             data: {userId:userId, jhnf:'2017',zt:type},
             dataType: "json",
             success: function(res){
                var thHtml = "";
				thHtml = ""
				var dataList = 	res;
				var trHtml = ""
				var html = "";
				if(dataList.length > 0){
					for(var i = 0; i< dataList.length; i++){
						var str = dataList[i].dbCjsj;
						var t = str.substring(0, 10);
						var id = dataList[i].jhid;
						var nf = dataList[i].jhnf;
						var jhbk = dataList[i].jhbk;
						var jhxh = dataList[i].jhxh;
						if(type == "未办"){
							trHtml+='<div class="contentList"><span class="content">'+
							'<a class="showdia" onclick="showDialogue(\' '+id+' \',\' '+nf+' \',\' '+jhbk+' \',\' '+jhxh+' \')">' + dataList[i].jhmc + '</a>' + 
							'</span>'
							'<span class="time">' + t + '</span></div>'
						}else{
							trHtml+='<div class="contentList"><span class="content">'+
							'<a class="showdia" onclick="showDetails(\' '+id+' \')">' + dataList[i].jhmc + '</a>' + 
							'</span>' + 
							'<span class="time">' + t + '</span></div>'							
						}
						
					}					
					html = thHtml + trHtml;
					$(".approveList").append(html);
				}else{				
					$(".approveList").append("<div class='nodata'>暂无数据</div>")
					$(".approveList").css("border","none");
				}					
            }
        });
		return false;
	}
	function showDialogue(id,jhnf,jhbk,jhxh){
		$(".appId").html(id);
		$(".jhnf").html(jhnf);
		$(".jhbk").html(jhbk);
		$(".jhxh").html(jhxh);
		var popBox = document.getElementById("popBox");
		var popLayer = document.getElementById("popLayer");
		popBox.style.display = "block";
		popLayer.style.display = "block";
	}
	function closeBox() {
		var popBox = document.getElementById("popBox");
		var popContent = document.getElementById("popContent");
		var popLayer = document.getElementById("popLayer");
		popBox.style.display = "none";
		popContent.style.display = "none";
		popLayer.style.display = "none";
	}
	//审核通过
	function submit(){
		var userArry = JSON.parse(sessionStorage.getItem('usInfo'))
		var userId = $.trim(userArry[0].usrId);
		var usrName = $.trim(userArry[0].usrName);
		var jhid = $.trim($(".appId").html());
		var jhnf = $.trim($(".jhnf").html());
		var jhbk = $.trim($(".jhbk").html());
		var jhxh = $.trim($(".jhxh").html());
		var czyj = $.trim($(".czyj").val());
		if(czyj == ""){
			$(".czyj").focus();
			return;
		}
		$.ajax({
            type: "POST",
            url: "http://10.18.3.98:8586/xntzjh/fgsjhfj/checkPass.d",
            data: {czzid:userId, czzxm:usrName,jhid:jhid,jhnf:jhnf, jhbk:jhbk,jhxh:jhxh,czyj: czyj},
            dataType: "json",
            success: function(res){
                if(res.message == "确认成功"){
					closeBox();
					approveList(type);
				}				
            }
        });
	}
	function showDetails(jhid){
		var id = $.trim(jhid);
		var popContent = document.getElementById("popContent");
		var popLayer = document.getElementById("popLayer");
		popContent.style.display = "block";
		popLayer.style.display = "block";
		$.ajax({
            type: "POST",
            url: "http://10.18.3.98:8586/xntzjh/fgsjhfj/fgsJhShDetail.d",
            data: {jhid:id},
            dataType: "json",
            success: function(res){
                if(res == null){
					$("#popContent .content").html("");
					$("#popContent .content").html("暂无详情");
				}else{
					var approveTime = res.czsj
					var time = approveTime.substring(0, 10);
					var approveResult = res.czjg
					var approveS = res.czyj
					$(".approveTime").html(time);
					$(".approveResult").html(approveResult);
					$(".approveS").html(approveS);
				}			
            }
        });		
	}
	function backApprove(){
		var userArry = JSON.parse(sessionStorage.getItem('usInfo'))
		var userId = $.trim(userArry[0].usrId);
		var usrName = $.trim(userArry[0].usrName);
		var jhid = $.trim($(".appId").html());
		var jhnf = $.trim($(".jhnf").html());
		var jhbk = $.trim($(".jhbk").html());
		var jhxh = $.trim($(".jhxh").html());
		var czyj = $.trim($(".czyj").val());
		$.ajax({
            type: "POST",
            url: "http://10.18.3.98:8586/xntzjh/fgsjhfj/checkBack.d",
            data: {czzid:userId, czzxm:usrName,jhid:jhid,jhnf:jhnf, jhbk:jhbk,jhxh:jhxh,czyj: czyj},
            dataType: "json",
            success: function(res){
                if(res.message == "退回成功"){
					closeBox();
					approveList(type);
				}	
            }
        });		
	}
</script>

</body>
</html>
